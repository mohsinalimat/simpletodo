<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Electron TODO</title>
    
    <!-- UIkit CSS -->
    <link rel="stylesheet" href="../assets/uikit/css/uikit.min.css" />

    <!-- UIkit JS -->
    <script src="../assets/uikit/js/uikit.min.js"></script>
    <script src="../assets/uikit/js/uikit-icons.min.js"></script>
</head>
<body>
    <!-- Menu Begin -->
    <div class="uk-navbar-container" uk-navbar>

        <div class="uk-navbar-left">
          <div class="uk-navbar-item">
            <a class="uk-navbar-toggle" uk-search-icon uk-toggle="target: .nav-overlay; animation: uk-animation-fade" href="#"></a>
            <div class="nav-overlay uk-navbar-left uk-flex-1" hidden>
              <div class="uk-navbar-item uk-width-expand">
                  <form onsubmit="searchItem()" action="index.html" class="uk-search uk-search-navbar uk-width-1-1">
                      <input id="search" class="uk-search-input" type="search" placeholder="Search..." autofocus>
                  </form>
              </div>
              <a class="uk-navbar-toggle" uk-close uk-toggle="target: .nav-overlay; animation: uk-animation-fade" href="#"></a>
            </div>
          </div>
        </div>

        <div class="uk-navbar-right">
            <div class="uk-navbar-item">
              <a id="groupAddBtn" class="uk-icon uk-text-primary" uk-icon="plus-circle"></a>
            </div>
        </div>
        
    </div>
    <!-- Menu End -->
    <div class="uk-container uk-width-2-3@s uk-margin-large-top uk-margin-large-bottom" id="todolist">
            
            <div><hr class="uk-divider-icon"></div>

            <div class="uk-text-center">
                <h1 id="message" class="uk-h1"></h1>
                <span id="msgExplain" class="uk-text-meta uk-text-danger"></span>
            </div>
            <!-- Example Lists Begin -->
            <div id="todoList" class="uk-child-width-1-1" uk-grid>
                
            </div>
            <!-- Example Lists End -->

            <div><hr class="uk-divider-icon uk-margin-medium-top"></div>

            <div>
                <a class="uk-align-right uk-icon-button" uk-icon="icon: chevron-up;ratio: 2;" href="" uk-scroll></a>
            </div>
    </div>

<script>
        const electron = require("electron");
        const { ipcRenderer } = electron; 

        let database;

        let groupAddBtn = document.querySelector("#groupAddBtn");
        groupAddBtn.addEventListener("click", () => {
            ipcRenderer.send("groupAdd");
        });

        function delBtn(id){
            ipcRenderer.send("Group:delete", id);
        };
        function editBtn(id){
            ipcRenderer.send("editBtn", id);
        };
        
        window.onload = function(){
            ipcRenderer.send("load:mainWindow")
            ipcRenderer.send("Search:ready")
        }

        ipcRenderer.on("send:todos", (e, data) => {
            database = data;
            if(database.todos.length === 0){
                document.querySelector("#message").innerHTML = "Nothing to List";
                document.querySelector("#msgExplain").innerHTML = "You have no todos"
            }else{
                var counter = 0;
                database.todos.forEach(todo => {
                    let todoList = document.querySelector("#todoList");
                    
                    let todoAsHTML = 
                    `<div id='todo${counter}'>
                    <div class='uk-card uk-card-default uk-card-hover uk-text-left'>
                    <div class='uk-card-header'>
                    <h3 class='uk-card-title'>
                    ${todo.groupName}
                    </h3>
                    </div>
                    <div class='uk-card-body'>
                    <ul class='uk-list uk-list-striped'>
                    ${todo.items}
                    </ul>
                    <div class='uk-align-right'>
                    <a onclick='editBtn(${counter})' id='editBtn' class='uk-icon-button uk-button-primary uk-margin-small-right' uk-icon='pencil'></a>
                    <a onclick='delBtn(${counter})' id='delBtn' class='uk-icon-button uk-button-danger' uk-icon='trash'></a>                        
                    </div>                  
                    </div>
                    </div>
                    </div>`;
                    todoList.innerHTML = todoList.innerHTML + todoAsHTML;
                    counter++;
                });
            }
        });

        function searchItem(){
            var target = document.querySelector("#search").value;

            ipcRenderer.send("Search:target", target);
        }

        ipcRenderer.on("Search:fail", () => {
            UIkit.notification.closeAll();
            UIkit.notification({message:"<span uk-icon='icon: warning'></span> No results",status:"warning"});
        });

        ipcRenderer.on("Search:success", (e, data) => {
            UIkit.notification.closeAll();
            UIkit.notification({message:`<span uk-icon='icon: warning'></span> <a class="uk-link-heading" href="#todo${data}">Go to first match!</a>`,status:"success"});
        })
    </script>
</body>
</html>