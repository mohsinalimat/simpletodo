<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add New TODO Group</title>
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="../assets/custom/style.css">

    <!-- UIkit CSS -->
    <link rel="stylesheet" href="../assets/uikit/css/uikit.min.css" />

    <!-- UIkit JS -->
    <script src="../assets/uikit/js/uikit.min.js"></script>
    <script src="../assets/uikit/js/uikit-icons.min.js"></script>

</head>
<body class="hide-overflow">
    <!-- Custom Titlebar Begin-->
    <div uk-sticky="sel-target: .uk-navbar-container; cls-active: uk-navbar-sticky">
        <div class="uk-navbar titlebar-slim titlebar-moveable" uk-navbar>
            <div class="uk-navbar-left uk-margin-small-left">
            <img src="../assets/img/icon.ico" width="20" height="20" alt="">
            <span class="uk-margin-small-left uk-text-meta text-white">Simple TODO</span>
            </div>
            <div class="uk-navbar-right">
                <div id="minimize" class="titlebar-button minimize uk-margin-small-right"></div>
                <div id="quit" class="titlebar-button quit uk-margin-small-right"></div>
            </div>
        </div>
    </div>
    <!-- Custom Titlebar End -->

    <div class="uk-container uk-text-left uk-margin-small-top">
    <form>
        <fieldset class="uk-fieldset">
            <div class="uk-margin">
                <label id="currentGroup" class="uk-form-label" for="form-stacked-text">Group Name<hr></label>
                <input class="uk-input" id="groupName" type="text">
            </div>
            <div class="uk-margin">
                <label class="uk-form-label" for="form-stacked-text">Items<hr></label>
                <textarea class="uk-textarea uk-height-small" placeholder="item1,&#13;item2,&#13;item3" id="contents"></textarea>
            </div>
            <div class="uk-margin">
                <label class="uk-form-label" for="form-stacked-text">TODO Priority<hr></label>
                <select id="priority" class="uk-select">
                    <option>HIGH</option>
                    <option>MEDIUM</option>
                    <option>LOW</option>
                    <option>FINISHED</option>
                </select>
            </div>
            <div class="uk-position-bottom-left uk-position-small">
                <span id="submit" class="uk-button uk-button-primary">Accept</span>
                <span id="cancel" class="uk-button uk-button-danger">Cancel</span>
            </div>
        </fieldset>
    </form>
    </div>

    <script>
        const electron = require("electron");
        require('../renderers/renderer.js');
        const { ipcRenderer } = electron; 
        const path = require('path');
        const fs = require('fs');

        let cancelBtn = document.querySelector("#cancel");
        let accptBtn = document.querySelector("#submit");

        dataPath = path.join(__dirname, '../database/todos.json');
        var database = JSON.parse(fs.readFileSync(dataPath).toString());
        var dataID;

        window.onload = function(){
            ipcRenderer.send("load:editWindow");
        }

        ipcRenderer.on("targetGroup", (e, data) => {
            dataID = data;
            document.querySelector("#groupName").value = database.todos[data].groupName;
            var todoItems = database.todos[data].items.replace(/<li>/gm,'').replace(/<\/li>/gm,'\n')
            document.querySelector("#contents").value = todoItems;
            document.querySelector("#priority").value = database.todos[data].priority.trim()
        });

        cancelBtn.addEventListener("click",() =>{
            window.close()
        });

        accptBtn.onclick = function() {
            const group = document.querySelector("#groupName").value;
            const items = document.querySelector("#contents").value;
            const priority = document.querySelector("#priority").value;
            if(group || items){
                var todoItems = database.todos[dataID].items.replace(/<li>/gm,'').replace(/<\/li>/gm,'\n')
                if(group === database.todos[dataID].groupName && items === todoItems && priority === database.todos[dataID].priority.trim()){
                    UIkit.notification.closeAll();    
                    UIkit.notification({message:"<span uk-icon='icon: warning'></span> No changes made!",status:'warning'});
                }else{
                    ipcRenderer.send("Group:edit",`${group.trim()} | ${items.trim()} | ${dataID} | ${priority.trim()}`)
                }
            }else{
                UIkit.notification.closeAll();    
                UIkit.notification({message:"<span uk-icon='icon: warning'></span> Form is empty!",status:'warning'});
            }
        }
    </script>
</body>
</html>