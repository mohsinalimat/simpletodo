<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add New TODO Group</title>
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="../assets/custom/style.css">

    <!-- UIkit CSS -->
    <link rel="stylesheet" href="../assets/uikit/css/uikit.min.css" />

    <!-- UIkit JS -->
    <script src="../assets/uikit/js/uikit.min.js"></script>
    <script src="../assets/uikit/js/uikit-icons.min.js"></script>

</head>
<body class="hide-overflow">
    <div class="uk-container uk-text-left">
    <form>
        <fieldset class="uk-fieldset">
            <div class="uk-margin">
                <label id="currentGroup" class="uk-form-label" for="form-stacked-text">Group Name<hr></label>
                <input class="uk-input" id="groupName" type="text">
            </div>
            <div class="uk-margin">
                <label class="uk-form-label" for="form-stacked-text">Items<hr></label>
                <textarea class="uk-textarea uk-height-small" placeholder="item1,&#13;item2,&#13;item3" id="contents"></textarea>
            </div>
            <div class="uk-margin">
                <label class="uk-form-label" for="form-stacked-text">TODO Priority<hr></label>
                <select id="priority" class="uk-select">
                    <option>HIGH</option>
                    <option>MEDIUM</option>
                    <option>LOW</option>
                    <option>FINISHED</option>
                </select>
            </div>
            <div class="uk-position-bottom-left uk-position-small">
                <span id="submit" class="uk-button uk-button-primary">Accept</span>
                <span id="cancel" class="uk-button uk-button-danger">Cancel</span>
            </div>
        </fieldset>
    </form>
    </div>

    <script>
        const electron = require("electron");
        const { ipcRenderer } = electron; 
        const path = require('path');
        const fs = require('fs');

        let cancelBtn = document.querySelector("#cancel");
        let accptBtn = document.querySelector("#submit");

        dataPath = path.join(__dirname, '../database/todos.json');
        var database = JSON.parse(fs.readFileSync(dataPath).toString());
        var dataID;

        window.onload = function(){
            ipcRenderer.send("load:editWindow");
        }

        ipcRenderer.on("targetGroup", (e, data) => {
            dataID = data;
            document.querySelector("#groupName").value = database.todos[data].groupName;
            var todoItems = database.todos[data].items.replace(/<li>/gm,'').replace(/<\/li>/gm,',\n')
            document.querySelector("#contents").value = todoItems.substring(0, todoItems.length -2);
        });

        cancelBtn.addEventListener("click",() =>{
            window.close()
        });

        accptBtn.onclick = function() {
            const group = document.querySelector("#groupName").value;
            const items = document.querySelector("#contents").value;
            const priority = document.querySelector("#priority").value;
            if(group || items){
                var todoItems = database.todos[dataID].items.replace(/<li>/gm,'').replace(/<\/li>/gm,',\n')
                if(group === database.todos[dataID].groupName && items === todoItems.substring(0, todoItems.length -2 && priority === todoItems.priority)){
                    UIkit.notification.closeAll();    
                    UIkit.notification({message:"<span uk-icon='icon: warning'></span> No changes made!",status:'warning'});
                }else{
                    ipcRenderer.send("Group:edit",`${group} | ${items} | ${dataID} | ${priority.trim()}`)
                }
            }else{
                UIkit.notification.closeAll();    
                UIkit.notification({message:"<span uk-icon='icon: warning'></span> Form is empty!",status:'warning'});
            }
        }
    </script>
</body>
</html>